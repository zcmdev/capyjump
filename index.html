<!DOCTYPE html>
<html>
  <head>
    <title>
      CapyJump
    </title>
    <link rel="stylesheet" href="Style/Level1.css">
    <link rel="stylesheet" href="Style/General.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Raleway:ital,wght@0,100;0,200; 0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Ms+Madi&display=swap" rel="stylesheet">
  </head>
  <body>
    <div class="top">
      <div class="top-left">
      </div>
      <div class="top-title">
        <p>
          Level 1
        </p>
      </div>
      <div class="top-right">
        <div class="js-score">
          Score
        </div>
      </div>
    </div>
    <div class="middle">
      <div class="middle-left">
      </div>
      <div class="middle-game">
        <div class="middle-hearts">
          <div class="space">
          </div>
          <div class="js-heart1">
          </div>
          <div class="js-heart2">
          </div>
          <div class="js-heart3">
          </div>
        </div>
        <div class="middle-sky">
          <div class="js-cloud1">
          </div>
        </div>
        <div class="middle-game-play">
          <div class="capybara">
          </div>
          <div class="orange">
          </div>
        </div>
        <div class="middle-game-ground">
          <div class="js-gameText">
          </div>
        </div>
      </div>
      <div class="middle-right">
        <button class="js-play" onclick="
          playGame();
        ">
          Play
        </button>
        <button class="js-stop" onclick="
          stopGame();
        ">
          Stop
        </button>
        <button class="js-jump" onclick="
          jump();    
        ">
          Jump
        </button>
      </div>
    </div>
    <div class="bottom">
      <div class="bottom-left">
      </div>
      <div class="bottom-middle">
        <div class="howToPlay">
          How to play
        </div>
        <div class="howToPlayRules">
          Try to jump over as many oranges as you can
        </div>
        <div>

        </div>
      </div>
      <div class="bottom-right">
        Designed by: Z. C. M
      </div>
    </div>
    <script>

      /*Initialization*/
      const charElement = document.querySelector('.capybara');
      const orangeElement = document.querySelector('.orange');
      const scoreElement = document.querySelector('.js-score');
      const heart1Element = document.querySelector('.js-heart1');
      const heart2Element = document.querySelector('.js-heart2');
      const heart3Element = document.querySelector('.js-heart3');
      const cloud1Element = document.querySelector('.js-cloud1');
      const gameTextElement = document.querySelector('.js-gameText');
      const gameBackgroundElement = document.querySelector('.middle-game-play');
      
      const orangeStop = -60;
      let orangemove = null;
      let cloud1 = null;
      let textReset = null;
      let gameTextLostDisplay = null;
      let removeText = null;
      let charPositionX = 0;
      let charPositionY = 0;
      let orangePositionX = 380;
      let cloud1PositionX = 0;
      let playing = false;
      let jumping = false;
      let play = false;
      let score = 0;
      let hit = 0;
      let cloud1Forward = true;
      let lost = false;
      let stopped = true;
      const block = 140;

      initialGame();

      function initialGame() {
        /*Game General*/
        gameBackgroundElement.style.backgroundImage = "url('Style/Image/house.jpg')";

        /*Character*/
        charElement.style.position = 'relative';
        charElement.style.left = '200px';

        /*Orange*/
        orangeElement.style.position = 'relative';
        orangeElement.style.top = '0px';
        orangeElement.style.left = '380px';
        orangeElement.style.visibility = 'hidden';

        /*Cloud*/
        cloud1Element.style.position = 'relative';
        
        /*Score*/
        scoreElement.innerHTML = `Score: ${score}`;

        /*Game Text*/
        gameTextReset();
      }

      function playGame() {
        if(lost) {
          /*Health*/
          resetHeart();
          lost = false;
        }

        if(!playing) {
          /*Game General*/
          play = true;
          playing = true;
          stopped = false;
          gameTextDisappear();
          gameBackgroundElement.style.backgroundImage = "url('Style/Image/orangetree.jpg')";
          gameBackgroundElement.style.border = 'none';

          /*Orange*/
          orangeElement.style.visibility = 'visible';
          orangemove = setInterval(animateOrange, 40);

          /*Cloud*/
          cloud1 = setInterval(cloud1Move, 1000);
        }
      }

      function resetGame() {
        /*Game General*/
        playing = false;
        play = false;
        gameBackgroundElement.style.backgroundImage = "url('Style/Image/house.jpg')";
        stopped = true;
        lost = false;

        /*Character*/

        /*Orange*/
        clearInterval(orangemove);
        originalPosition();
        orangeElement.style.visibility = 'hidden';

        /*Cloud*/
        clearInterval(cloud1);

        /*Score*/
        resetScore();

        /*Game Text*/
        textReset = setTimeout(gameTextReset, 900);

        /*Health*/
        resetHeart();
      }

      function stopGame() {
        if(!lost && !stopped) {
          resetGame();
        }
      }


      function lostGame() {
        /*Game General*/
        playing = false;
        play = false;
        gameBackgroundElement.style.backgroundImage = "url('Style/Image/lost.jpg')";
        lost = true;
        stopped = true;

        /*Orange*/
        clearInterval(orangemove);
        originalPosition();
        orangeElement.style.visibility = 'hidden';

        /*Cloud*/
        clearInterval(cloud1);

        /*Score*/
        resetScore();

        /*Game Text*/
        gameTextLostDisplay = setTimeout(gameTextLost, 900);
      }

      /*** Functions ***/

      /*** Character ***/

      function jump() {
        if(!jumping && play) {
          charPositionY = charPositionY - 100;
          charElement.style.top = charPositionY + 'px';
          const returnJump = setTimeout(jumpDown, 400);
          jumping = true;
        }
      }

      function jumpDown() {
        charPositionY = charPositionY + 100;
        charElement.style.top = charPositionY + 'px';
        jumping = false;
      }

      /*** Orange ***/

      function animateOrange() { //Move the Orange Hurdle
        if(orangePositionX === orangeStop) {
          originalPosition();
        } else {
          orangePositionX = orangePositionX - 5;
          orangeElement.style.left = orangePositionX + 'px';
          if(orangePositionX === block) {
            if(charPositionY === 0) {
              scoreBoard('0');
              hit++;
              removeHeart();
              if(hit === 3) {
                lostGame();
              } else {
                displayGameText('Missed!');
              }
            }
            else {
              scoreBoard('1');
              displayGameText('Nice!');
            }
          }
        }
      }

      function originalPosition() { //Reset the Orange Position
        orangeElement.style.left = '380px';
        orangePositionX = 380;
      }

      /*** Cloud ***/

      function cloud1Move() {
        if(cloud1Forward) {
          if(cloud1PositionX === 380) {
            cloud1Forward = false;
          } else {
            cloud1PositionX = cloud1PositionX + 10;
            cloud1Element.style.left = cloud1PositionX + 'px';
          }
        } else {
          if(cloud1PositionX === 0) {
            cloud1Forward = true;
          } else {
            cloud1PositionX = cloud1PositionX - 10;
            cloud1Element.style.left = cloud1PositionX + 'px';
          }
        }
      }

      /*** Scoreboard ***/

      function scoreBoard(win) {
        if(win === '1') {
          score++;
          scoreElement.innerHTML = `Score: ${score}`;
        }
      }

      function resetScore() {
        score = 0;
        hit = 0;
        scoreElement.innerHTML = `Score: ${score}`;
      }

      /*** Gametext ***/

      function displayGameText(text) {
        gameTextElement.innerHTML = text;
        removeText = setTimeout(gameTextDisappear, 800);
      }

      function gameTextDisappear() {
        gameTextElement.innerHTML = '';
      }

      function gameTextReset() {
        gameTextElement.innerHTML = 'Click Play and jump over the orange';
      }

      function gameTextLost() {
        gameTextElement.innerHTML = 'Lost all Health, Play Again?';
      }

      /*** Health ***/

      function removeHeart() {
        if(hit === 1) {
          /*heart1Element.style.backgroundColor = 'white';*/
          heart1Element.style.backgroundImage = "url('Style/Image/Greyheart.png')";
        }
        else if(hit === 2) {
          heart2Element.style.backgroundImage = "url('Style/Image/Greyheart.png')";
        }
        else if(hit === 3) {
          heart3Element.style.backgroundImage = "url('Style/Image/Greyheart.png')";
        }
      }

      function resetHeart() {
        heart1Element.style.backgroundImage = "url('Style/Image/heart.png')";
        heart2Element.style.backgroundImage = "url('Style/Image/heart.png')";
        heart3Element.style.backgroundImage = "url('Style/Image/heart.png')";
      }

      /*****************/
    </script>
  </body>
</html>
